import{s as o,j as e}from"./index-CZWYOJc5.js";import{r as h,u as p}from"./vendor-C93i42Td.js";import{k as f,a0 as b,t as j,T as N,a1 as w}from"./ui-DKXepuIc.js";class v{async createAffiliate(i){try{const{data:t,error:a}=await o.rpc("create_affiliate",{user_id:i});if(a)throw a;return t}catch(t){throw console.error("Error creating affiliate:",t),t}}async getAffiliateInfo(i){var t;try{const{data:a,error:s}=await o.rpc("get_affiliate_info",{user_id:i});if(s)throw s;const{data:c,error:d}=await o.from("affiliate_referrals").select("*").eq("affiliate_id",(t=a[0])==null?void 0:t.id).order("created_at",{ascending:!1});if(d)throw d;return{...a[0],affiliate_referrals:c||[]}}catch(a){throw console.error("Error getting affiliate info:",a),a}}async recordReferralVisit(i){try{localStorage.setItem("referralCode",i);const{data:t,error:a}=await o.from("affiliates").select("id, code").eq("code",i).single();if(a)throw a;const{error:s}=await o.from("affiliate_referrals").insert({affiliate_id:t.id,status:"pending"});if(s)throw s;return!0}catch(t){return console.error("Error recording referral:",t),!1}}async convertReferral(i,t){try{const a=localStorage.getItem("referralCode");if(!a)return;const{data:s,error:c}=await o.from("affiliates").select("id, commission_rate").eq("code",a).single();if(c)throw c;const d=t*s.commission_rate/100,{error:l}=await o.from("affiliate_referrals").update({referred_user_id:i,status:"converted",commission_amount:d}).eq("affiliate_id",s.id).eq("status","pending");if(l)throw l;const{error:m}=await o.rpc("update_affiliate_earnings",{affiliate_id:s.id,amount:d});if(m)throw m;return localStorage.removeItem("referralCode"),!0}catch(a){return console.error("Error converting referral:",a),!1}}}const x=new v,A=()=>{const[n,i]=h.useState(null),[t,a]=h.useState(!0),s=p();h.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:{user:r}}=await o.auth.getUser();if(!r){f.error("Please sign in to access the affiliate dashboard"),s("/login");return}const u=await x.getAffiliateInfo(r.id);i(u)}catch(r){console.error("Error loading affiliate data:",r),f.error("Failed to load affiliate data")}finally{a(!1)}},d=()=>{if(!(n!=null&&n.code)){f.error("No referral link available");return}const r=`${window.location.origin}/?ref=${n.code}`;navigator.clipboard.writeText(r),f.success("Referral link copied to clipboard!")};if(t)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"text-center py-12",children:"Loading..."})})});if(!n)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Become an Affiliate"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Share PropVid with your audience and earn 10% commission on every sale!"}),e.jsx("button",{onClick:async()=>{try{const{data:{user:r}}=await o.auth.getUser();if(!r){f.error("Please sign in to become an affiliate"),s("/login");return}await x.createAffiliate(r.id),f.success("Affiliate account created!"),c()}catch(r){console.error("Error creating affiliate:",r),f.error("Failed to create affiliate account")}},className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Join Affiliate Program"})]})})});const l=n.affiliate_referrals||[],m=n.total_earnings||0;l.filter(r=>r.status==="pending").length;const g=l.filter(r=>r.status==="converted").length;return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Affiliate Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(b,{className:"text-green-500"}),e.jsx("h3",{className:"font-bold",children:"Total Earnings"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(j,{className:"text-blue-500"}),e.jsx("h3",{className:"font-bold",children:"Total Referrals"})]}),e.jsx("p",{className:"text-2xl font-bold",children:l.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(N,{className:"text-purple-500"}),e.jsx("h3",{className:"font-bold",children:"Conversion Rate"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[l.length?(g/l.length*100).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-8",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Your Referral Link"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:`${window.location.origin}/?ref=${n.code}`,readOnly:!0,className:"flex-1 p-3 border rounded bg-gray-50"}),e.jsx("button",{onClick:d,className:"p-3 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(w,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"font-bold",children:"Recent Referrals"})}),e.jsx("div",{className:"p-6",children:l.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Date"}),e.jsx("th",{className:"pb-3 font-medium",children:"Status"}),e.jsx("th",{className:"pb-3 font-medium",children:"Commission"})]})}),e.jsx("tbody",{children:l.map(r=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-3",children:new Date(r.created_at).toLocaleDateString()}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm ${r.status==="converted"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r.status})}),e.jsx("td",{className:"py-3",children:r.commission_amount?`$${r.commission_amount.toFixed(2)}`:"-"})]},r.id))})]})}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No referrals yet. Share your link to start earning!"})})]})]})})};export{A as default};
//# sourceMappingURL=AffiliateStats-Dbo8r6JX.js.map
