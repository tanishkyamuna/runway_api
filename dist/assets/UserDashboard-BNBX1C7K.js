import{s as l,j as e}from"./index-CZWYOJc5.js";import{r as i,L as n}from"./vendor-C93i42Td.js";import{k as c,n as C,A as _,x as j,S as k,P as D,o as E,g as P,X as S}from"./ui-DKXepuIc.js";const L=()=>{var g;const[r,v]=i.useState(null),[o,p]=i.useState(null),[m,x]=i.useState([]),[N,f]=i.useState(!0),[h,u]=i.useState(null);i.useEffect(()=>{w();const s=l.channel("videos-channel").on("postgres_changes",{event:"UPDATE",schema:"public",table:"videos",filter:`user_id=eq.${r==null?void 0:r.id}`},a=>{a.new.status==="completed"&&(x(t=>t.map(d=>d.id===a.new.id?a.new:d)),c.success("Your video is ready!"))}).subscribe();return()=>{l.removeChannel(s)}},[r==null?void 0:r.id]);const w=async()=>{try{const{data:{user:s}}=await l.auth.getUser();if(v(s),s){const{data:a,error:t}=await l.from("user_credits").select("*").eq("user_id",s.id).single();if(t)throw t;p(a);const{data:d,error:b}=await l.from("videos").select(`
            *,
            template:templates(*),
            generation:video_generations(*)
          `).eq("user_id",s.id).order("created_at",{ascending:!1});if(b)throw b;x(d||[])}}catch(s){console.error("Error fetching user data:",s),c.error("Error fetching user data")}finally{f(!1)}},y=async s=>{try{const{data:{publicUrl:a}}=l.storage.from("videos").getPublicUrl(s.video_path),t=document.createElement("a");t.href=a,t.download=`property-video-${s.id}.mp4`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(a){console.error("Error downloading video:",a),c.error("Failed to download video")}};return N?e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:"Loading..."})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-8",children:["Welcome, ",((g=r==null?void 0:r.user_metadata)==null?void 0:g.name)||"User"]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Available Credits"}),e.jsx("p",{className:"text-gray-600",children:"Create more videos to grow your business"})]}),e.jsxs(n,{to:"/pricing",className:"inline-flex items-center text-blue-600 hover:text-blue-700",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"Buy Credits",e.jsx(_,{className:"w-4 h-4 ml-1"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Credits Remaining"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(o==null?void 0:o.free_videos_remaining)||0})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs(n,{to:"/create",className:"bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow",children:[e.jsx(j,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"font-bold mb-2",children:"Create New Video"}),e.jsx("p",{className:"text-gray-600",children:"Transform your property images into stunning videos"})]}),e.jsxs(n,{to:"/settings",className:"bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow",children:[e.jsx(k,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"font-bold mb-2",children:"Account Settings"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account preferences and billing"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-xl font-bold",children:"Your Videos"})}),e.jsx("div",{className:"divide-y",children:m.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No videos yet. Create your first video!"}):m.map(s=>{var a;return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold mb-2",children:((a=s.template)==null?void 0:a.title)||"Property Video"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.status==="completed"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"Preview",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>y(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"Download",children:e.jsx(E,{className:"w-5 h-5"})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[e.jsx(P,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{children:"Processing..."})]})})]})},s.id)})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-black rounded-lg w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>u(null),className:"absolute -top-10 right-0 text-white hover:text-gray-300",children:e.jsx(S,{className:"w-8 h-8"})}),e.jsx("video",{src:l.storage.from("videos").getPublicUrl(h.video_path).data.publicUrl,controls:!0,autoPlay:!0,className:"w-full rounded-lg"})]})})]})})};export{L as default};
//# sourceMappingURL=UserDashboard-BNBX1C7K.js.map
