{"version":3,"file":"UserDashboard-BNBX1C7K.js","sources":["../../src/components/UserDashboard.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '../lib/supabase';\nimport { Video, Clock, Settings, Package, ArrowRight, CreditCard, Download, Play, X } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\nconst UserDashboard = () => {\n  const [user, setUser] = useState(null);\n  const [credits, setCredits] = useState(null);\n  const [videos, setVideos] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedVideo, setSelectedVideo] = useState(null);\n\n  useEffect(() => {\n    fetchUserData();\n\n    // Subscribe to video updates\n    const channel = supabase\n      .channel('videos-channel')\n      .on('postgres_changes', \n        { \n          event: 'UPDATE', \n          schema: 'public', \n          table: 'videos',\n          filter: `user_id=eq.${user?.id}`\n        }, \n        (payload) => {\n          if (payload.new.status === 'completed') {\n            // Update videos list\n            setVideos(prevVideos => \n              prevVideos.map(video => \n                video.id === payload.new.id ? payload.new : video\n              )\n            );\n            // Show notification\n            toast.success('Your video is ready!');\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [user?.id]);\n\n  const fetchUserData = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      setUser(user);\n\n      if (user) {\n        // Fetch credits\n        const { data: creditsData, error: creditsError } = await supabase\n          .from('user_credits')\n          .select('*')\n          .eq('user_id', user.id)\n          .single();\n\n        if (creditsError) throw creditsError;\n        setCredits(creditsData);\n\n        // Fetch videos\n        const { data: videosData, error: videosError } = await supabase\n          .from('videos')\n          .select(`\n            *,\n            template:templates(*),\n            generation:video_generations(*)\n          `)\n          .eq('user_id', user.id)\n          .order('created_at', { ascending: false });\n\n        if (videosError) throw videosError;\n        setVideos(videosData || []);\n      }\n    } catch (error) {\n      console.error('Error fetching user data:', error);\n      toast.error('Error fetching user data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownload = async (video) => {\n    try {\n      const { data: { publicUrl } } = supabase.storage\n        .from('videos')\n        .getPublicUrl(video.video_path);\n\n      // Create a temporary link to download the file\n      const link = document.createElement('a');\n      link.href = publicUrl;\n      link.download = `property-video-${video.id}.mp4`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Error downloading video:', error);\n      toast.error('Failed to download video');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          Loading...\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <h1 className=\"text-3xl font-bold mb-8\">Welcome, {user?.user_metadata?.name || 'User'}</h1>\n\n        {/* Credits Card */}\n        <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\n          <div className=\"flex justify-between items-start mb-6\">\n            <div>\n              <h2 className=\"text-xl font-bold mb-2\">Available Credits</h2>\n              <p className=\"text-gray-600\">Create more videos to grow your business</p>\n            </div>\n            <Link\n              to=\"/pricing\"\n              className=\"inline-flex items-center text-blue-600 hover:text-blue-700\"\n            >\n              <Package className=\"w-5 h-5 mr-2\" />\n              Buy Credits\n              <ArrowRight className=\"w-4 h-4 ml-1\" />\n            </Link>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"bg-blue-50 p-4 rounded-lg\">\n              <div className=\"flex items-center gap-3\">\n                <Video className=\"text-blue-600\" />\n                <div>\n                  <div className=\"text-sm text-gray-600\">Credits Remaining</div>\n                  <div className=\"text-2xl font-bold text-blue-600\">\n                    {credits?.free_videos_remaining || 0}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n          <Link\n            to=\"/create\"\n            className=\"bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow\"\n          >\n            <Video className=\"w-8 h-8 text-blue-600 mb-3\" />\n            <h3 className=\"font-bold mb-2\">Create New Video</h3>\n            <p className=\"text-gray-600\">\n              Transform your property images into stunning videos\n            </p>\n          </Link>\n\n          <Link\n            to=\"/settings\"\n            className=\"bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow\"\n          >\n            <Settings className=\"w-8 h-8 text-blue-600 mb-3\" />\n            <h3 className=\"font-bold mb-2\">Account Settings</h3>\n            <p className=\"text-gray-600\">\n              Manage your account preferences and billing\n            </p>\n          </Link>\n        </div>\n\n        {/* Videos List */}\n        <div className=\"bg-white rounded-lg shadow\">\n          <div className=\"p-6 border-b\">\n            <h2 className=\"text-xl font-bold\">Your Videos</h2>\n          </div>\n\n          <div className=\"divide-y\">\n            {videos.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">\n                No videos yet. Create your first video!\n              </div>\n            ) : (\n              videos.map((video) => (\n                <div key={video.id} className=\"p-6\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-bold mb-2\">\n                        {video.template?.title || 'Property Video'}\n                      </h3>\n                      <div className=\"text-sm text-gray-500\">\n                        Created: {new Date(video.created_at).toLocaleDateString()}\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2\">\n                      {video.status === 'completed' ? (\n                        <>\n                          <button\n                            onClick={() => setSelectedVideo(video)}\n                            className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg\"\n                            title=\"Preview\"\n                          >\n                            <Play className=\"w-5 h-5\" />\n                          </button>\n                          <button\n                            onClick={() => handleDownload(video)}\n                            className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg\"\n                            title=\"Download\"\n                          >\n                            <Download className=\"w-5 h-5\" />\n                          </button>\n                        </>\n                      ) : (\n                        <div className=\"flex items-center gap-2 text-yellow-600\">\n                          <Clock className=\"w-5 h-5 animate-pulse\" />\n                          <span>Processing...</span>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n\n        {/* Video Preview Modal */}\n        {selectedVideo && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4\">\n            <div className=\"relative bg-black rounded-lg w-full max-w-4xl\">\n              <button\n                onClick={() => setSelectedVideo(null)}\n                className=\"absolute -top-10 right-0 text-white hover:text-gray-300\"\n              >\n                <X className=\"w-8 h-8\" />\n              </button>\n              <video\n                src={supabase.storage.from('videos').getPublicUrl(selectedVideo.video_path).data.publicUrl}\n                controls\n                autoPlay\n                className=\"w-full rounded-lg\"\n              />\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserDashboard;"],"names":["UserDashboard","user","setUser","useState","credits","setCredits","videos","setVideos","loading","setLoading","selectedVideo","setSelectedVideo","useEffect","fetchUserData","channel","supabase","payload","prevVideos","video","toast","creditsData","creditsError","videosData","videosError","error","handleDownload","publicUrl","link","jsx","jsxs","_a","Link","Package","ArrowRight","Video","Settings","Fragment","Play","Download","Clock","X"],"mappings":"4LAMA,MAAMA,EAAgB,IAAM,OAC1B,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,IAAI,EAC/B,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,IAAI,EACrC,CAACG,EAAQC,CAAS,EAAIJ,EAAAA,SAAS,CAAA,CAAE,EACjC,CAACK,EAASC,CAAU,EAAIN,EAAAA,SAAS,EAAI,EACrC,CAACO,EAAeC,CAAgB,EAAIR,EAAAA,SAAS,IAAI,EAEvDS,EAAAA,UAAU,IAAM,CACAC,EAAA,EAGd,MAAMC,EAAUC,EACb,QAAQ,gBAAgB,EACxB,GAAG,mBACF,CACE,MAAO,SACP,OAAQ,SACR,MAAO,SACP,OAAQ,cAAcd,GAAA,YAAAA,EAAM,EAAE,EAChC,EACCe,GAAY,CACPA,EAAQ,IAAI,SAAW,cAEzBT,KACEU,EAAW,OACTC,EAAM,KAAOF,EAAQ,IAAI,GAAKA,EAAQ,IAAME,CAAA,CAEhD,EAEAC,EAAM,QAAQ,sBAAsB,EACtC,GAGH,UAAU,EAEb,MAAO,IAAM,CACXJ,EAAS,cAAcD,CAAO,CAChC,CAAA,EACC,CAACb,GAAA,YAAAA,EAAM,EAAE,CAAC,EAEb,MAAMY,EAAgB,SAAY,CAC5B,GAAA,CACI,KAAA,CAAE,KAAM,CAAE,KAAAZ,IAAW,MAAMc,EAAS,KAAK,QAAQ,EAGvD,GAFAb,EAAQD,CAAI,EAERA,EAAM,CAER,KAAM,CAAE,KAAMmB,EAAa,MAAOC,GAAiB,MAAMN,EACtD,KAAK,cAAc,EACnB,OAAO,GAAG,EACV,GAAG,UAAWd,EAAK,EAAE,EACrB,OAAO,EAEV,GAAIoB,EAAoB,MAAAA,EACxBhB,EAAWe,CAAW,EAGhB,KAAA,CAAE,KAAME,EAAY,MAAOC,CAAA,EAAgB,MAAMR,EACpD,KAAK,QAAQ,EACb,OAAO;AAAA;AAAA;AAAA;AAAA,WAIP,EACA,GAAG,UAAWd,EAAK,EAAE,EACrB,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAE3C,GAAIsB,EAAmB,MAAAA,EACbhB,EAAAe,GAAc,EAAE,CAAA,QAErBE,EAAO,CACN,QAAA,MAAM,4BAA6BA,CAAK,EAChDL,EAAM,MAAM,0BAA0B,CAAA,QACtC,CACAV,EAAW,EAAK,CAAA,CAEpB,EAEMgB,EAAiB,MAAOP,GAAU,CAClC,GAAA,CACF,KAAM,CAAE,KAAM,CAAE,UAAAQ,CAAA,CAAY,EAAIX,EAAS,QACtC,KAAK,QAAQ,EACb,aAAaG,EAAM,UAAU,EAG1BS,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACPC,EAAA,SAAW,kBAAkBT,EAAM,EAAE,OACjC,SAAA,KAAK,YAAYS,CAAI,EAC9BA,EAAK,MAAM,EACF,SAAA,KAAK,YAAYA,CAAI,QACvBH,EAAO,CACN,QAAA,MAAM,2BAA4BA,CAAK,EAC/CL,EAAM,MAAM,0BAA0B,CAAA,CAE1C,EAEA,OAAIX,EAEAoB,EAAA,IAAC,OAAI,UAAU,8BACb,eAAC,MAAI,CAAA,UAAU,oBAAoB,SAAA,YAAA,CAEnC,CACF,CAAA,QAKD,MAAI,CAAA,UAAU,8BACb,SAACC,EAAA,KAAA,MAAA,CAAI,UAAU,oBACb,SAAA,CAACA,EAAAA,KAAA,KAAA,CAAG,UAAU,0BAA0B,SAAA,CAAA,cAAUC,EAAA7B,GAAA,YAAAA,EAAM,gBAAN,YAAA6B,EAAqB,OAAQ,MAAA,EAAO,EAGtFD,EAAAA,KAAC,MAAI,CAAA,UAAU,sCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAACD,EAAA,IAAA,KAAA,CAAG,UAAU,yBAAyB,SAAiB,oBAAA,EACvDA,EAAA,IAAA,IAAA,CAAE,UAAU,gBAAgB,SAAwC,0CAAA,CAAA,CAAA,EACvE,EACAC,EAAA,KAACE,EAAA,CACC,GAAG,WACH,UAAU,6DAEV,SAAA,CAACH,EAAAA,IAAAI,EAAA,CAAQ,UAAU,cAAe,CAAA,EAAE,cAEpCJ,EAAAA,IAACK,EAAW,CAAA,UAAU,cAAe,CAAA,CAAA,CAAA,CAAA,CACvC,EACF,EAEAL,EAAA,IAAC,MAAI,CAAA,UAAU,wCACb,SAAAA,EAAA,IAAC,MAAI,CAAA,UAAU,4BACb,SAAAC,OAAC,MAAI,CAAA,UAAU,0BACb,SAAA,CAACD,EAAAA,IAAAM,EAAA,CAAM,UAAU,eAAgB,CAAA,SAChC,MACC,CAAA,SAAA,CAACN,EAAA,IAAA,MAAA,CAAI,UAAU,wBAAwB,SAAiB,oBAAA,QACvD,MAAI,CAAA,UAAU,mCACZ,UAAAxB,GAAA,YAAAA,EAAS,wBAAyB,CACrC,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CACF,CAAA,CAAA,EACF,EAGAyB,EAAAA,KAAC,MAAI,CAAA,UAAU,6CACb,SAAA,CAAAA,EAAA,KAACE,EAAA,CACC,GAAG,UACH,UAAU,mEAEV,SAAA,CAACH,EAAAA,IAAAM,EAAA,CAAM,UAAU,4BAA6B,CAAA,EAC7CN,EAAA,IAAA,KAAA,CAAG,UAAU,iBAAiB,SAAgB,mBAAA,EAC9CA,EAAA,IAAA,IAAA,CAAE,UAAU,gBAAgB,SAE7B,qDAAA,CAAA,CAAA,CAAA,CACF,EAEAC,EAAA,KAACE,EAAA,CACC,GAAG,YACH,UAAU,mEAEV,SAAA,CAACH,EAAAA,IAAAO,EAAA,CAAS,UAAU,4BAA6B,CAAA,EAChDP,EAAA,IAAA,KAAA,CAAG,UAAU,iBAAiB,SAAgB,mBAAA,EAC9CA,EAAA,IAAA,IAAA,CAAE,UAAU,gBAAgB,SAE7B,6CAAA,CAAA,CAAA,CAAA,CAAA,CACF,EACF,EAGAC,EAAAA,KAAC,MAAI,CAAA,UAAU,6BACb,SAAA,CAACD,EAAAA,IAAA,MAAA,CAAI,UAAU,eACb,SAAAA,EAAA,IAAC,MAAG,UAAU,oBAAoB,uBAAW,CAC/C,CAAA,EAEAA,EAAA,IAAC,MAAI,CAAA,UAAU,WACZ,SAAAtB,EAAO,SAAW,EACjBsB,EAAAA,IAAC,MAAI,CAAA,UAAU,gCAAgC,SAAA,yCAAA,CAE/C,EAEAtB,EAAO,IAAKY,GACTU,OAAAA,OAAAA,EAAAA,IAAA,MAAA,CAAmB,UAAU,MAC5B,SAAAC,EAAA,KAAC,MAAI,CAAA,UAAU,mCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,SACb,SAAA,CAAAD,MAAC,MAAG,UAAU,iBACX,WAAME,EAAAZ,EAAA,WAAA,YAAAY,EAAU,QAAS,iBAC5B,EACAD,EAAAA,KAAC,MAAI,CAAA,UAAU,wBAAwB,SAAA,CAAA,YAC3B,IAAI,KAAKX,EAAM,UAAU,EAAE,mBAAmB,CAAA,CAC1D,CAAA,CAAA,EACF,QAEC,MAAI,CAAA,UAAU,0BACZ,SAAMA,EAAA,SAAW,YAEdW,EAAAA,KAAAO,EAAA,SAAA,CAAA,SAAA,CAAAR,EAAA,IAAC,SAAA,CACC,QAAS,IAAMjB,EAAiBO,CAAK,EACrC,UAAU,gDACV,MAAM,UAEN,SAAAU,EAAAA,IAACS,EAAK,CAAA,UAAU,SAAU,CAAA,CAAA,CAC5B,EACAT,EAAA,IAAC,SAAA,CACC,QAAS,IAAMH,EAAeP,CAAK,EACnC,UAAU,gDACV,MAAM,WAEN,SAAAU,EAAAA,IAACU,EAAS,CAAA,UAAU,SAAU,CAAA,CAAA,CAAA,CAChC,CACF,CAAA,EAEAT,EAAAA,KAAC,MAAI,CAAA,UAAU,0CACb,SAAA,CAACD,EAAAA,IAAAW,EAAA,CAAM,UAAU,uBAAwB,CAAA,EACzCX,EAAAA,IAAC,QAAK,SAAa,eAAA,CAAA,CAAA,CAAA,CACrB,CAEJ,CAAA,CAAA,CAAA,CACF,CApCQ,EAAAV,EAAM,EAqChB,EACD,CAEL,CAAA,CAAA,EACF,EAGCR,SACE,MAAI,CAAA,UAAU,iFACb,SAACmB,EAAAA,KAAA,MAAA,CAAI,UAAU,gDACb,SAAA,CAAAD,EAAA,IAAC,SAAA,CACC,QAAS,IAAMjB,EAAiB,IAAI,EACpC,UAAU,0DAEV,SAAAiB,EAAAA,IAACY,EAAE,CAAA,UAAU,SAAU,CAAA,CAAA,CACzB,EACAZ,EAAA,IAAC,QAAA,CACC,IAAKb,EAAS,QAAQ,KAAK,QAAQ,EAAE,aAAaL,EAAc,UAAU,EAAE,KAAK,UACjF,SAAQ,GACR,SAAQ,GACR,UAAU,mBAAA,CAAA,CACZ,CAAA,CACF,CACF,CAAA,CAAA,CAAA,CAEJ,CACF,CAAA,CAEJ"}