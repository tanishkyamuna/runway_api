{"version":3,"file":"SignUpForm-DsW0svDX.js","sources":["../../src/lib/emailService.js","../../src/components/auth/SignUpForm.jsx"],"sourcesContent":["import { supabase } from './supabase';\nimport toast from 'react-hot-toast';\n\nclass EmailService {\n  async sendEmail(userId, templateType, data = {}) {\n    try {\n      if (!userId) {\n        throw new Error('User ID is required');\n      }\n\n      if (!templateType) {\n        throw new Error('Template type is required');\n      }\n\n      console.log('Sending email:', { userId, templateType, data });\n\n      // Get user details\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      if (userError) throw userError;\n\n      // Get template\n      const { data: template, error: templateError } = await supabase\n        .from('email_templates')\n        .select('*')\n        .eq('type', templateType)\n        .single();\n\n      if (templateError) {\n        console.error('Template error:', templateError);\n        throw new Error('Failed to fetch email template');\n      }\n\n      if (!template) {\n        throw new Error(`Email template \"${templateType}\" not found`);\n      }\n\n      // Replace template variables\n      const subject = this.replaceVariables(template.subject, {\n        ...data,\n        name: user.user_metadata?.name || 'there'\n      });\n\n      const body = this.replaceVariables(template.body, {\n        ...data,\n        name: user.user_metadata?.name || 'there'\n      });\n\n      console.log('Prepared email:', { subject, body });\n\n      // Log the email\n      await this.logEmail(userId, templateType, 'sent', null, data);\n\n      // In a real implementation, you would send the email here\n      // For now, we'll just show a toast\n      toast.success(`Email sent: ${subject}`);\n\n      return { success: true, subject, body };\n    } catch (error) {\n      console.error('Error sending email:', error);\n      \n      // Log the failed attempt\n      await this.logEmail(userId, templateType, 'failed', error.message, data);\n      \n      throw error;\n    }\n  }\n\n  // Helper method to replace template variables\n  replaceVariables(template, data) {\n    if (!template) return '';\n    \n    return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n      return data[key] !== undefined ? data[key] : match;\n    });\n  }\n\n  // Helper method to log emails\n  async logEmail(userId, templateType, status, error = null, metadata = {}) {\n    try {\n      console.log('Logging email:', { userId, templateType, status, error, metadata });\n\n      const { error: logError } = await supabase\n        .from('email_logs')\n        .insert({\n          user_id: userId,\n          template_type: templateType,\n          status,\n          error,\n          metadata\n        });\n\n      if (logError) {\n        console.error('Error logging email:', logError);\n        throw logError;\n      }\n    } catch (err) {\n      console.error('Error logging email:', err);\n    }\n  }\n\n  // Helper methods for common notifications\n  async sendWelcomeEmail(userId, credits) {\n    return this.sendEmail(userId, 'welcome', { credits });\n  }\n\n  async sendVideoStartedEmail(userId, data) {\n    return this.sendEmail(userId, 'video_started', data);\n  }\n\n  async sendVideoCompleteEmail(userId, data) {\n    return this.sendEmail(userId, 'video_complete', data);\n  }\n\n  async sendLowCreditsEmail(userId, creditsRemaining) {\n    return this.sendEmail(userId, 'low_credits', { credits_remaining: creditsRemaining });\n  }\n}\n\nexport const emailService = new EmailService();","import React, { useState } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { supabase } from '../../lib/supabase';\nimport { emailService } from '../../lib/emailService';\nimport { Mail, Lock, User } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\nconst SignUpForm = () => {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    password: '',\n  });\n  const [isLoading, setIsLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const { data, error } = await supabase.auth.signUp({\n        email: formData.email,\n        password: formData.password,\n        options: {\n          data: {\n            name: formData.name\n          }\n        }\n      });\n\n      if (error) throw error;\n\n      // Send welcome email\n      await emailService.sendWelcomeEmail(data.user.id, 2);\n\n      toast.success('Account created successfully! Check your email for a welcome message.');\n      navigate('/login');\n    } catch (error) {\n      toast.error(error.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"text-center text-3xl font-bold\">Create your account</h2>\n          <p className=\"mt-2 text-center text-gray-600\">\n            Get 2 free videos when you sign up!\n          </p>\n          <p className=\"mt-2 text-center text-gray-600\">\n            Already have an account?{' '}\n            <Link to=\"/login\" className=\"text-blue-600 hover:text-blue-700\">\n              Sign in\n            </Link>\n          </p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"mt-8 space-y-6\">\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Full Name\n              </label>\n              <div className=\"mt-1 relative\">\n                <User className=\"absolute left-3 top-3 text-gray-400\" size={20} />\n                <input\n                  type=\"text\"\n                  required\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                  placeholder=\"John Doe\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Email address\n              </label>\n              <div className=\"mt-1 relative\">\n                <Mail className=\"absolute left-3 top-3 text-gray-400\" size={20} />\n                <input\n                  type=\"email\"\n                  required\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  className=\"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                  placeholder=\"you@example.com\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Password\n              </label>\n              <div className=\"mt-1 relative\">\n                <Lock className=\"absolute left-3 top-3 text-gray-400\" size={20} />\n                <input\n                  type=\"password\"\n                  required\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  className=\"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                  placeholder=\"••••••••\"\n                  minLength={6}\n                />\n              </div>\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n          >\n            {isLoading ? 'Creating account...' : 'Sign up'}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default SignUpForm;"],"names":["EmailService","userId","templateType","data","user","userError","supabase","template","templateError","subject","_a","body","_b","toast","error","match","key","status","metadata","logError","err","credits","creditsRemaining","emailService","SignUpForm","formData","setFormData","useState","isLoading","setIsLoading","navigate","useNavigate","handleSubmit","e","jsxs","jsx","Link","User","Mail","Lock"],"mappings":"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"}