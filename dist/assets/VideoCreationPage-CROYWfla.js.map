{"version":3,"file":"VideoCreationPage-CROYWfla.js","sources":["../../src/lib/retryService.js","../../src/lib/webhookService.js","../../src/lib/storageService.js","../../src/components/VideoCreationPage.jsx"],"sourcesContent":["class RetryService {\n  constructor() {\n    this.DEFAULT_MAX_RETRIES = 3;\n    this.DEFAULT_TIMEOUT = 30000; // 30 seconds\n  }\n\n  async withRetries(operation, options = {}) {\n    const {\n      maxRetries = this.DEFAULT_MAX_RETRIES,\n      timeout = this.DEFAULT_TIMEOUT,\n      retryableErrors = ['FunctionsFetchError', 'TypeError', 'FetchError'],\n      onRetry = null\n    } = options;\n\n    let lastError;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        // Execute operation with timeout\n        const result = await Promise.race([\n          operation(attempt),\n          new Promise((_, reject) => \n            setTimeout(() => reject(new Error('Request timeout')), timeout)\n          )\n        ]);\n\n        return result;\n\n      } catch (error) {\n        lastError = error;\n        console.error(`Attempt ${attempt} failed:`, {\n          attempt,\n          error: {\n            message: error.message,\n            name: error.name,\n            stack: error.stack\n          }\n        });\n\n        // Check if we should retry\n        if (this._shouldRetry(error, attempt, maxRetries, retryableErrors)) {\n          // Call retry callback if provided\n          if (onRetry) {\n            await onRetry(attempt, error);\n          }\n\n          // Wait with exponential backoff\n          await this._wait(attempt);\n          continue;\n        }\n\n        break;\n      }\n    }\n\n    throw this._enhanceError(lastError, maxRetries);\n  }\n\n  _shouldRetry(error, attempt, maxRetries, retryableErrors) {\n    if (attempt >= maxRetries) {\n      return false;\n    }\n\n    // Retry on specified error types\n    if (retryableErrors.includes(error.name)) {\n      return true;\n    }\n\n    // Retry on timeout\n    if (error.message === 'Request timeout') {\n      return true;\n    }\n\n    // Retry on network errors\n    if (error.message.includes('network') || error.message.includes('Failed to fetch')) {\n      return true;\n    }\n\n    // Retry on specific HTTP status codes\n    if (error.status) {\n      return [408, 429, 500, 502, 503, 504].includes(error.status);\n    }\n\n    return false;\n  }\n\n  async _wait(attempt) {\n    const baseDelay = Math.min(1000 * Math.pow(2, attempt - 1), 10000);\n    const jitter = Math.random() * 1000;\n    await new Promise(resolve => setTimeout(resolve, baseDelay + jitter));\n  }\n\n  _enhanceError(error, maxRetries) {\n    if (!error) {\n      return new Error('Operation failed after retries');\n    }\n\n    error.retriesExhausted = true;\n    error.maxRetries = maxRetries;\n    \n    if (error.name === 'FunctionsFetchError') {\n      error.message = 'Failed to connect to video service after multiple attempts. Please try again later.';\n    }\n\n    return error;\n  }\n}\n\nexport const retryService = new RetryService();","import { supabase } from './supabase';\nimport { retryService } from './retryService';\nimport toast from 'react-hot-toast';\n\nclass WebhookService {\n  // Production Make.com webhook URL - DO NOT CHANGE\n  static MAKE_WEBHOOK_URL = 'https://hook.eu1.make.com/urhqhs1gwa9j3ykqnnpgmitsvpnkrmdk';\n\n  async createVideo(imageUrl, template) {\n    try {\n      if (!imageUrl) throw new Error('Image URL is required');\n      if (!template?.id) throw new Error('Template ID is required');\n\n      // Get current user\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      if (userError) throw new Error(`Authentication error: ${userError.message}`);\n      if (!user) throw new Error('Please sign in to create videos');\n\n      // Create video record\n      const { data: video, error: videoError } = await supabase\n        .from('videos')\n        .insert({\n          user_id: user.id,\n          template_id: template.id,\n          image_path: imageUrl,\n          status: 'pending'\n        })\n        .select()\n        .single();\n\n      if (videoError) {\n        console.error('Video creation error:', videoError);\n        throw new Error(`Failed to create video record: ${videoError.message}`);\n      }\n\n      // Create generation record\n      const { error: genError } = await supabase\n        .from('video_generations')\n        .insert({\n          video_id: video.id,\n          status: 'pending',\n          progress: 0\n        });\n\n      if (genError) {\n        console.error('Generation record error:', genError);\n        throw new Error(`Failed to create generation record: ${genError.message}`);\n      }\n\n      // Convert orientation format\n      const aspectRatio = template.orientation === 'portrait' ? '9:16' : '16:9';\n\n      // Call Make.com webhook with retries\n      const result = await retryService.withRetries(\n        async (attempt) => {\n          console.log(`Attempt ${attempt} to call webhook`);\n\n          const response = await fetch(WebhookService.MAKE_WEBHOOK_URL, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'text/plain'\n            },\n            body: JSON.stringify({\n              videoId: video.id,\n              userId: user.id,\n              imageUrl: imageUrl,\n              templateId: template.id,\n              template: {\n                id: template.id,\n                title: template.title,\n                prompt: template.prompt || `Create a cinematic property video showcasing ${template.title}`,\n                style: template.style || 'cinematic',\n                duration: template.duration || 10,\n                aspectRatio: aspectRatio // Using standardized format\n              },\n              callbacks: {\n                success: `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/video-complete`,\n                error: `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/video-error`\n              }\n            })\n          });\n\n          if (!response.ok) {\n            const errorText = await response.text();\n            throw new Error(`Make.com webhook failed: ${response.status} ${response.statusText}. Response: ${errorText}`);\n          }\n\n          // Handle text response\n          const responseText = await response.text();\n          if (responseText.toLowerCase() !== 'accepted') {\n            throw new Error(`Unexpected response from Make.com: ${responseText}`);\n          }\n\n          return { success: true };\n        },\n        {\n          maxRetries: 3,\n          timeout: 30000,\n          onRetry: (attempt, error) => {\n            console.warn(`Retry ${attempt} due to error:`, error);\n            toast.error(`Retrying video creation (${attempt}/3)...`);\n          }\n        }\n      );\n\n      // Update video status to processing\n      const { error: updateError } = await supabase\n        .from('videos')\n        .update({ \n          status: 'processing',\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', video.id);\n\n      if (updateError) {\n        console.error('Error updating video status:', updateError);\n      }\n\n      return { success: true, videoId: video.id };\n\n    } catch (error) {\n      console.error('Error creating video:', error);\n\n      // Show user-friendly error message\n      let userMessage = 'Failed to create video. ';\n      if (error.message.includes('Authentication')) {\n        userMessage += 'Please sign in and try again.';\n      } else if (error.message.includes('timeout')) {\n        userMessage += 'The request timed out. Please try again.';\n      } else if (error.message.includes('network')) {\n        userMessage += 'Please check your internet connection.';\n      } else {\n        userMessage += 'Please try again later.';\n      }\n\n      toast.error(userMessage);\n      throw error;\n    }\n  }\n}\n\n// Freeze the webhook service to prevent modifications\nObject.freeze(WebhookService);\nObject.freeze(WebhookService.prototype);\n\nexport const webhookService = new WebhookService();\nObject.freeze(webhookService);","import { supabase } from './supabase';\n\n/**\n * Service for handling file storage operations\n */\nclass StorageService {\n  constructor() {\n    // Constants\n    this.MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\n    this.ALLOWED_TYPES = [\n      'image/jpeg',\n      'image/png',\n      'image/webp'\n    ];\n  }\n\n  /**\n   * Uploads an image file to storage\n   * @param {File} file - The image file to upload\n   * @param {string} userId - The user's ID\n   * @returns {Promise<{path: string, url: string}>}\n   * @throws {Error} If validation fails or upload fails\n   */\n  async uploadImage(file, userId) {\n    try {\n      // Validate inputs\n      this._validateFile(file);\n      this._validateUserId(userId);\n\n      // Generate unique file path\n      const { filePath, fileName } = this._generateFilePath(file, userId);\n\n      // Upload file\n      const { error: uploadError } = await supabase.storage\n        .from('images')\n        .upload(filePath, file, {\n          cacheControl: '3600',\n          upsert: false,\n          contentType: file.type\n        });\n\n      if (uploadError) {\n        console.error('Upload error:', uploadError);\n        throw new Error('Failed to upload image');\n      }\n\n      // Get public URL\n      const { data: { publicUrl } } = supabase.storage\n        .from('images')\n        .getPublicUrl(filePath);\n\n      if (!publicUrl) {\n        throw new Error('Failed to get public URL');\n      }\n\n      return {\n        path: filePath,\n        url: publicUrl\n      };\n    } catch (error) {\n      console.error('Storage service error:', {\n        message: error.message,\n        stack: error.stack,\n        details: error\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Validates the file\n   * @private\n   */\n  _validateFile(file) {\n    if (!file) {\n      throw new Error('No file provided');\n    }\n\n    if (!this.ALLOWED_TYPES.includes(file.type)) {\n      throw new Error('Invalid file type. Only JPEG, PNG and WebP images are allowed.');\n    }\n\n    if (file.size > this.MAX_FILE_SIZE) {\n      throw new Error('File size must be less than 5MB');\n    }\n  }\n\n  /**\n   * Validates the user ID\n   * @private\n   */\n  _validateUserId(userId) {\n    if (!userId) {\n      throw new Error('User ID is required');\n    }\n  }\n\n  /**\n   * Generates a unique file path\n   * @private\n   */\n  _generateFilePath(file, userId) {\n    const timestamp = Date.now();\n    const randomString = Math.random().toString(36).substring(7);\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${timestamp}-${randomString}.${fileExt}`;\n    const filePath = `${userId}/${fileName}`;\n\n    return { filePath, fileName };\n  }\n\n  /**\n   * Downloads a video file\n   * @param {string} videoPath - Path to the video file\n   * @returns {Promise<Blob>}\n   * @throws {Error} If download fails\n   */\n  async downloadVideo(videoPath) {\n    try {\n      if (!videoPath) {\n        throw new Error('Video path is required');\n      }\n\n      const { data, error } = await supabase.storage\n        .from('videos')\n        .download(videoPath);\n\n      if (error) {\n        console.error('Download error:', error);\n        throw new Error('Failed to download video');\n      }\n\n      return data;\n    } catch (error) {\n      console.error('Download error:', {\n        message: error.message,\n        stack: error.stack,\n        details: error\n      });\n      throw error;\n    }\n  }\n}\n\nexport const storageService = new StorageService();","import React, { useState } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { Upload, Image as ImageIcon, AlertCircle, Sparkles, Wand2, Clock } from 'lucide-react';\nimport { supabase } from '../lib/supabase';\nimport { webhookService } from '../lib/webhookService';\nimport { storageService } from '../lib/storageService';\nimport toast from 'react-hot-toast';\n\nconst VideoCreationPage = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const template = location.state?.template;\n  const [file, setFile] = useState(null);\n  const [preview, setPreview] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [duration, setDuration] = useState(template?.defaultDuration || 10);\n\n  // Redirect if no template selected\n  if (!template) {\n    navigate('/templates');\n    return null;\n  }\n\n  const handleFileChange = (e) => {\n    const selectedFile = e.target.files[0];\n    if (!selectedFile) return;\n\n    if (!selectedFile.type.startsWith('image/')) {\n      toast.error('Please select a valid image file');\n      return;\n    }\n\n    if (selectedFile.size > 5 * 1024 * 1024) {\n      toast.error('Image size must be less than 5MB');\n      return;\n    }\n\n    setFile(selectedFile);\n    const reader = new FileReader();\n    reader.onloadend = () => setPreview(reader.result);\n    reader.readAsDataURL(selectedFile);\n  };\n\n  const handleSubmit = async () => {\n    if (!file) {\n      toast.error('Please select an image');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Please sign in to create videos');\n\n      // Verify credits\n      const { data: credits, error: creditsError } = await supabase\n        .from('user_credits')\n        .select('free_videos_remaining')\n        .eq('user_id', user.id)\n        .single();\n\n      if (creditsError || !credits || credits.free_videos_remaining <= 0) {\n        throw new Error('No credits remaining. Please upgrade your plan.');\n      }\n\n      // Upload image\n      const { url: imageUrl } = await storageService.uploadImage(file, user.id);\n      if (!imageUrl) throw new Error('Failed to upload image');\n\n      // Create video with selected duration\n      const result = await webhookService.createVideo(imageUrl, {\n        ...template,\n        duration,\n        imageOrientation: template.orientation || 'landscape'\n      });\n      \n      if (!result.success) throw new Error('Failed to start video creation');\n\n      // Deduct credit\n      const { error: updateError } = await supabase\n        .from('user_credits')\n        .update({\n          free_videos_remaining: credits.free_videos_remaining - 1,\n          updated_at: new Date().toISOString()\n        })\n        .eq('user_id', user.id);\n\n      if (updateError) throw updateError;\n\n      toast.success('Video creation started successfully!');\n      navigate('/dashboard');\n    } catch (error) {\n      console.error('Error creating video:', error);\n      setError(error.message || 'Failed to create video');\n      toast.error(error.message || 'Failed to create video');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-12\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl font-bold mb-4\">Create Your Video</h1>\n          <p className=\"text-xl text-gray-600\">\n            Upload your image and we'll transform it using the {template.title} template\n          </p>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow-lg overflow-hidden\">\n          {/* Template Preview */}\n          <div className=\"p-6 border-b\">\n            <h2 className=\"text-xl font-bold mb-4\">Selected Template</h2>\n            <div className={`relative ${template.orientation === 'portrait' ? 'aspect-[9/16]' : 'aspect-video'} rounded-lg overflow-hidden`}>\n              <img\n                src={template.image_url}\n                alt={template.title}\n                className=\"w-full h-full object-cover\"\n              />\n              <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end\">\n                <div className=\"p-4 text-white\">\n                  <h3 className=\"text-lg font-bold\">{template.title}</h3>\n                  <p className=\"text-sm\">{template.description}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Duration Selection */}\n          <div className=\"p-6 border-b\">\n            <h2 className=\"text-xl font-bold mb-4\">Video Duration</h2>\n            <div className=\"flex gap-4\">\n              <button\n                onClick={() => setDuration(5)}\n                className={`flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 ${\n                  duration === 5 \n                    ? 'bg-blue-600 text-white' \n                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }`}\n              >\n                <Clock className=\"w-5 h-5\" />\n                5 Seconds\n              </button>\n              <button\n                onClick={() => setDuration(10)}\n                className={`flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 ${\n                  duration === 10 \n                    ? 'bg-blue-600 text-white' \n                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }`}\n              >\n                <Clock className=\"w-5 h-5\" />\n                10 Seconds\n              </button>\n            </div>\n          </div>\n\n          {/* Image Upload */}\n          <div className=\"p-6\">\n            <h2 className=\"text-xl font-bold mb-4\">Upload Your Image</h2>\n            <div className=\"mb-6\">\n              <input\n                type=\"file\"\n                id=\"image-upload\"\n                className=\"hidden\"\n                onChange={handleFileChange}\n                accept=\"image/*\"\n              />\n              <label\n                htmlFor=\"image-upload\"\n                className=\"cursor-pointer block\"\n              >\n                {preview ? (\n                  <div className={`relative ${template.orientation === 'portrait' ? 'aspect-[9/16]' : 'aspect-video'}`}>\n                    <img\n                      src={preview}\n                      alt=\"Preview\"\n                      className=\"w-full h-full object-cover rounded-lg\"\n                    />\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 hover:opacity-100 transition-opacity rounded-lg\">\n                      <span className=\"text-white\">Change Image</span>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center\">\n                    <Upload className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-600\">Drop your image here or click to browse</p>\n                    <p className=\"text-sm text-gray-500 mt-2\">\n                      {template.orientation === 'portrait' \n                        ? 'Best with vertical (9:16) images'\n                        : 'Best with landscape (16:9) images'\n                      }\n                    </p>\n                  </div>\n                )}\n              </label>\n            </div>\n\n            {/* Create Button */}\n            <button\n              onClick={handleSubmit}\n              disabled={!file || isLoading}\n              className=\"relative w-full group\"\n            >\n              <div className=\"absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg blur opacity-25 group-hover:opacity-100 transition duration-1000 group-hover:duration-200\"></div>\n              <div className=\"relative w-full px-7 py-6 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg leading-none flex items-center justify-center space-x-3\">\n                {isLoading ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent\" />\n                    <span className=\"text-white text-lg font-bold\">Creating Magic...</span>\n                  </>\n                ) : (\n                  <>\n                    <Wand2 className=\"w-6 h-6 text-white\" />\n                    <span className=\"text-white text-lg font-bold\">Create {duration}-Second Video</span>\n                    <Sparkles className=\"w-6 h-6 text-white\" />\n                  </>\n                )}\n              </div>\n            </button>\n\n            {error && (\n              <div className=\"mt-4 p-4 bg-red-50 text-red-600 rounded-lg flex items-center gap-2\">\n                <AlertCircle className=\"w-5 h-5\" />\n                <p>{error}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default VideoCreationPage;"],"names":["RetryService","operation","options","maxRetries","timeout","retryableErrors","onRetry","lastError","attempt","_","reject","error","baseDelay","jitter","resolve","retryService","_WebhookService","imageUrl","template","user","userError","supabase","video","videoError","genError","aspectRatio","result","response","errorText","responseText","toast","updateError","userMessage","__publicField","WebhookService","webhookService","StorageService","file","userId","filePath","fileName","uploadError","publicUrl","timestamp","randomString","fileExt","videoPath","data","storageService","VideoCreationPage","navigate","useNavigate","_a","useLocation","setFile","useState","preview","setPreview","isLoading","setIsLoading","setError","duration","setDuration","handleFileChange","e","selectedFile","reader","handleSubmit","credits","creditsError","jsxs","jsx","Clock","Upload","Fragment","Wand2","Sparkles","AlertCircle"],"mappings":"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"}