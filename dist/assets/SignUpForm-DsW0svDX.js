import{s as m,j as e}from"./index-CZWYOJc5.js";import{r as p,u as x,L as f}from"./vendor-C93i42Td.js";import{k as u,R as w,a as y,v as b}from"./ui-DKXepuIc.js";class v{async sendEmail(r,s,t={}){var i,o;try{if(!r)throw new Error("User ID is required");if(!s)throw new Error("Template type is required");console.log("Sending email:",{userId:r,templateType:s,data:t});const{data:{user:a},error:n}=await m.auth.getUser();if(n)throw n;const{data:c,error:g}=await m.from("email_templates").select("*").eq("type",s).single();if(g)throw console.error("Template error:",g),new Error("Failed to fetch email template");if(!c)throw new Error(`Email template "${s}" not found`);const d=this.replaceVariables(c.subject,{...t,name:((i=a.user_metadata)==null?void 0:i.name)||"there"}),h=this.replaceVariables(c.body,{...t,name:((o=a.user_metadata)==null?void 0:o.name)||"there"});return console.log("Prepared email:",{subject:d,body:h}),await this.logEmail(r,s,"sent",null,t),u.success(`Email sent: ${d}`),{success:!0,subject:d,body:h}}catch(a){throw console.error("Error sending email:",a),await this.logEmail(r,s,"failed",a.message,t),a}}replaceVariables(r,s){return r?r.replace(/\{\{(\w+)\}\}/g,(t,i)=>s[i]!==void 0?s[i]:t):""}async logEmail(r,s,t,i=null,o={}){try{console.log("Logging email:",{userId:r,templateType:s,status:t,error:i,metadata:o});const{error:a}=await m.from("email_logs").insert({user_id:r,template_type:s,status:t,error:i,metadata:o});if(a)throw console.error("Error logging email:",a),a}catch(a){console.error("Error logging email:",a)}}async sendWelcomeEmail(r,s){return this.sendEmail(r,"welcome",{credits:s})}async sendVideoStartedEmail(r,s){return this.sendEmail(r,"video_started",s)}async sendVideoCompleteEmail(r,s){return this.sendEmail(r,"video_complete",s)}async sendLowCreditsEmail(r,s){return this.sendEmail(r,"low_credits",{credits_remaining:s})}}const j=new v,_=()=>{const[l,r]=p.useState({name:"",email:"",password:""}),[s,t]=p.useState(!1),i=x(),o=async a=>{a.preventDefault(),t(!0);try{const{data:n,error:c}=await m.auth.signUp({email:l.email,password:l.password,options:{data:{name:l.name}}});if(c)throw c;await j.sendWelcomeEmail(n.user.id,2),u.success("Account created successfully! Check your email for a welcome message."),i("/login")}catch(n){u.error(n.message)}finally{t(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-3xl font-bold",children:"Create your account"}),e.jsx("p",{className:"mt-2 text-center text-gray-600",children:"Get 2 free videos when you sign up!"}),e.jsxs("p",{className:"mt-2 text-center text-gray-600",children:["Already have an account?"," ",e.jsx(f,{to:"/login",className:"text-blue-600 hover:text-blue-700",children:"Sign in"})]})]}),e.jsxs("form",{onSubmit:o,className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(w,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{type:"text",required:!0,value:l.name,onChange:a=>r({...l,name:a.target.value}),className:"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"John Doe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(y,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{type:"email",required:!0,value:l.email,onChange:a=>r({...l,email:a.target.value}),className:"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"you@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx(b,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{type:"password",required:!0,value:l.password,onChange:a=>r({...l,password:a.target.value}),className:"pl-10 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"••••••••",minLength:6})]})]})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?"Creating account...":"Sign up"})]})]})})};export{_ as default};
//# sourceMappingURL=SignUpForm-DsW0svDX.js.map
